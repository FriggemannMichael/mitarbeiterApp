@if (isOpen()) {
  <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
      <div class="p-6">
        <!-- Header -->
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-lg font-semibold text-gray-900">
            {{ 'export.send' | translate }}
          </h3>
          <button
            (click)="onClose()"
            class="text-gray-400 hover:text-gray-600 transition-colors"
          >
            ‚úï
          </button>
        </div>

        <!-- File Info -->
        <div class="bg-gray-50 rounded-lg p-4 mb-6">
          <p class="text-sm text-gray-600 mb-1">{{ 'shareModal.file' | translate }}</p>
          <p class="font-medium text-gray-900">{{ fileName() }}</p>
          <p class="text-xs text-gray-500 mt-2">
            {{ employeeName() }} ‚Ä¢ KW {{ weekNumber() }}/{{ weekYear() }}
          </p>
        </div>

        <!-- Customer Email Info -->
        @if (customerEmail() && customerEmail()!.trim()) {
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-6">
            <div class="flex items-start space-x-2">
              <div class="text-blue-600 mt-0.5 flex-shrink-0">‚úâ</div>
              <div>
                <p class="text-sm font-medium text-blue-900">
                  {{ 'shareModal.customerCopy' | translate }}
                </p>
                <p class="text-xs text-blue-700 mt-1">
                  {{ 'shareModal.customerReceives' | translate }}
                  <span class="font-medium">{{ customerEmail() }}</span>
                </p>
              </div>
            </div>
          </div>
        }

        <!-- Send Button -->
        <div class="flex flex-col gap-4 mb-6">
          <button
            class="w-full btn-primary disabled:bg-gray-300 disabled:cursor-not-allowed text-sm flex items-center justify-center space-x-2"
            (click)="handleEmailShare()"
            [disabled]="isSending"
          >
            @if (isSending) {
              <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
              <span>{{ 'shareModal.sending' | translate }}</span>
            } @else if (success) {
              <span>{{ 'shareModal.sent' | translate }}</span>
            } @else {
              <span>{{ 'export.send' | translate }}</span>
            }
          </button>
        </div>

        <!-- Email Selection -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Empf√§nger-E-Mail:
          </label>
          <select
            [(ngModel)]="selectedEmail"
            class="w-full input-field"
          >
            @for (email of allowedEmails; track email) {
              <option [value]="email">{{ email }}</option>
            }
          </select>
          <p class="text-xs text-gray-500 mt-1">
            Nur freigegebene E-Mail-Adressen verf√ºgbar
          </p>
        </div>

        <!-- Cancel Button -->
        <div class="flex space-x-3">
          <button
            (click)="onClose()"
            class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
          >
            {{ 'actions.cancel' | translate }}
          </button>
        </div>

        <!-- Security Notice -->
        <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
          <p class="text-xs text-yellow-800">
            üîí Sicherheitshinweis: Aus Datenschutzgr√ºnden k√∂nnen nur vordefinierte Empf√§nger ausgew√§hlt werden.
          </p>
        </div>
      </div>
    </div>
  </div>
}
