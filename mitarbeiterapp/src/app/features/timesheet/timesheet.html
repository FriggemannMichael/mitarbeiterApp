@if (loading) {
  <div class="min-h-screen bg-gray-50 flex items-center justify-center">
    <div class="animate-spin w-12 h-12 border-4 border-primary border-t-transparent rounded-full"></div>
  </div>
} @else if (weekData) {
  <div class="min-h-screen bg-gray-50">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b sticky top-0 z-40">
      <div class="max-w-md mx-auto px-4 py-4">
        <div class="text-center mb-4">
          <img src="/assets/logo-westfalia.png" alt="Logo" class="h-12 mx-auto mb-2" />
          <h1 class="text-xl font-bold text-gray-900">{{ 'timesheet.title' | translate }}</h1>
          <p class="text-sm text-gray-600">{{ weekData.employeeName }}</p>
        </div>

        <!-- Week Navigation -->
        <div class="flex items-center justify-between">
          <button (click)="navigateWeek('prev')" [disabled]="!isEditable" class="p-2 rounded-lg hover:bg-gray-100">◄</button>
          <div class="text-center">
            <div class="text-primary font-semibold">
              {{ 'timesheet.week' | translate }} {{ currentWeek.week }}/{{ currentWeek.year }}
            </div>
            <p class="text-xs text-gray-500">{{ getDateRange() }}</p>
          </div>
          <button (click)="navigateWeek('next')" [disabled]="!isEditable" class="p-2 rounded-lg hover:bg-gray-100">►</button>
        </div>

        <div class="mt-3 text-center">
          <button (click)="navigateWeek('current')" class="btn-secondary text-sm">{{ 'nav.today' | translate }}</button>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="max-w-md mx-auto p-4 space-y-4">
      <!-- Customer -->
      <div class="card p-4 space-y-4">
        <div>
          <label class="block font-medium text-gray-900 mb-2">
            {{ 'timesheet.customer' | translate }} <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            [value]="weekData.customer"
            (input)="onCustomerChange($any($event.target).value)"
            [disabled]="!isEditable"
            class="input-field disabled:bg-gray-100"
            [placeholder]="'timesheet.placeholders.customer' | translate"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            {{ 'timesheet.customerEmailOptional' | translate }}
          </label>
          <input
            type="email"
            [value]="weekData.customerEmail || ''"
            (input)="onCustomerEmailChange($any($event.target).value)"
            [disabled]="!isEditable"
            class="input-field disabled:bg-gray-100"
            [placeholder]="'timesheet.placeholders.customerEmail' | translate"
          />
          <p class="text-xs text-gray-500 mt-1">
            {{ 'timesheet.customerEmailHelp' | translate }}
          </p>
        </div>
      </div>

      <!-- Shift Model -->
      <app-shift-dropdown
        [currentModel]="weekData.shiftModel || 'day'"
        [isEditable]="isEditable"
        (openConfig)="onOpenShiftConfig()"
      />

      <!-- Day Cards -->
      @for (day of weekData.days; track day.date; let i = $index) {
        <app-day-card
          [day]="day"
          [dayName]="getDayNames()[i]"
          [dayIndex]="i"
          [isEditable]="isEditable"
          (timeChange)="onDayTimeChange($event)"
        />
      }

      <!-- Total Hours -->
      <div class="card p-4 bg-primary text-white">
        <div class="flex items-center justify-between">
          <span class="font-medium">{{ 'timesheet.total' | translate }}</span>
          <div class="text-right">
            <div class="text-xl font-bold">{{ totalHours.hours }}</div>
            <div class="text-sm opacity-90">{{ totalHours.decimal }}h</div>
          </div>
        </div>
      </div>

      <!-- Signatures -->
      <app-signature-pad
        [title]="'signature.employee' | translate"
        [signatureData]="weekData.employeeSignature"
        [disabled]="!isEditable"
        [locked]="weekData.locked"
        (sign)="onAddSignature('employee', $event)"
        (clear)="onClearSignature('employee')"
      />

      <app-signature-pad
        [title]="'signature.supervisor' | translate"
        [signatureData]="weekData.supervisorSignature"
        [disabled]="!canSupervisorSign"
        [locked]="weekData.locked"
        [requireName]="true"
        [nameValue]="weekData.supervisorName"
        [namePlaceholder]="'signature.supervisorNamePlaceholder' | translate"
        (sign)="onAddSignature('supervisor', $event)"
        (clear)="onClearSignature('supervisor')"
      />

      <!-- Actions -->
      <div class="space-y-3">
        <div class="grid grid-cols-2 gap-3">
          <button
            (click)="onExportPDF()"
            [disabled]="!weekData.employeeSignature || !weekData.supervisorSignature"
            class="btn-primary disabled:opacity-50"
          >
            {{ 'export.pdf' | translate }}
          </button>
          <button
            (click)="onSharePDF()"
            [disabled]="!weekData.employeeSignature || !weekData.supervisorSignature"
            class="btn-primary disabled:opacity-50"
          >
            {{ 'export.send' | translate }}
          </button>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <button (click)="onClearWeek()" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg">
            {{ 'actions.clearTimes' | translate }}
          </button>
          <button (click)="onLogout()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
            {{ 'actions.logout' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Shift Config Modal -->
  <app-shift-config-modal
    [isOpen]="showShiftConfigModal"
    [currentModel]="weekData.shiftModel || 'day'"
    (close)="onCloseShiftConfig()"
    (apply)="onApplyShiftConfig($event)"
  />

  <!-- Share Modal -->
  <app-share-modal
    [isOpen]="showShareModal"
    [fileName]="shareFileName"
    [fileUrl]="shareFileUrl"
    [employeeName]="weekData.employeeName"
    [weekNumber]="currentWeek.week"
    [weekYear]="currentWeek.year"
    [customerEmail]="weekData.customerEmail || ''"
    [pdfBlob]="sharePdfBlob"
    (close)="onCloseShareModal()"
    (shareComplete)="onShareComplete()"
  />
}
